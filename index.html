<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Japanese Learning Guide</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@400;700&family=Inter:wght@400;600;700&family=JetBrains+Mono:wght@400;600;700&family=Lato:wght@400;700&family=Noto+Sans+JP:wght@400;500;600;700&family=Nunito:wght@400;600;700&family=Open+Sans:wght@400;600;700&family=Poppins:wght@400;600;700&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.cdnfonts.com/css/opendyslexic" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
</head>
<body>
<script>if(localStorage.getItem('jp_darkMode')==='true')document.body.classList.add('dark-mode');</script>

<!-- Loading Screen -->
<div id="loading-screen" class="loading-screen">
    <div class="loading-content">
        <div class="loading-spinner">
            <div class="spinner-ring"></div>
            <div class="spinner-ring"></div>
            <div class="spinner-ring"></div>
        </div>
        <h2 class="loading-title">Japanese Learning Guide</h2>
        <p class="loading-subtitle">Loading your study materials...</p>
    </div>
</div>

<!-- Background Music -->
<audio id="bg-music" loop preload="none">
    <source src="audio/silent-snow-lake.mp3" type="audio/mpeg">
</audio>
<!-- Feedback Widget -->
<button class="fb-float-btn" id="fb-float-btn" title="Send Feedback">&#128172;</button>
<div class="fb-float-panel" id="fb-float-panel">
    <div class="fb-float-header">
        <span>Feedback</span>
        <button class="fb-float-close" id="fb-float-close">&times;</button>
    </div>
    <div class="fb-float-body">
        <select id="fb-type">
            <option value="bug">Bug Report</option>
            <option value="feature">Feature Request</option>
            <option value="comment">General Comment</option>
        </select>
        <textarea id="fb-message" placeholder="Describe the issue, idea, or comment..."></textarea>
        <button class="btn btn-primary" id="fb-submit" style="width:100%">Send Feedback</button>
        <div class="fb-confirmation" id="fb-confirmation">Thanks for your feedback!</div>
    </div>
</div>

<button class="music-btn" id="music-toggle" title="Toggle background music">&#9835;</button>

<div class="bg-overlay" id="bg-overlay"></div>
<div id="app">

<!-- ==================== HUB VIEW ==================== -->
<div id="view-hub" class="view active">
    <div style="background:linear-gradient(135deg,#fff3cd,#ffeeba);border:2px solid #ffc107;border-radius:12px;padding:14px 20px;margin-bottom:16px;text-align:center;font-size:0.9rem;color:#856404;font-weight:600;">New sign-ups are temporarily unavailable. Existing users can still sign in.</div>
    <div class="hub-header">
        <h1>Japanese Learning Guide</h1>
        <p>Pick a topic to study</p>
        <div style="display:flex;align-items:center;justify-content:center;gap:10px;margin-top:12px;">
            <button class="btn btn-hint btn-sm" id="settings-btn" title="Settings">&#9881;</button>
            <span id="auth-bar"></span>
        </div>
        <div class="settings-dropdown" id="settings-dropdown">
            <label class="settings-item">
                <span>Dark Mode</span>
                <button class="btn btn-hint btn-sm" id="dark-toggle">Off</button>
            </label>
            <label class="settings-item">
                <span>Background</span>
                <input type="file" id="bg-upload" accept="image/*" hidden>
                <button class="btn btn-hint btn-sm" id="bg-choose">Choose</button>
                <button class="btn btn-hint btn-sm" id="bg-clear" style="display:none">Clear</button>
            </label>
            <label class="settings-item">
                <span>Opacity</span>
                <input type="range" id="bg-opacity" min="0" max="100" value="15" style="width:100px">
                <span id="bg-opacity-val">15%</span>
            </label>
            <label class="settings-item">
                <span>Music</span>
                <button class="btn btn-hint btn-sm" id="music-setting-toggle">Off</button>
                <input type="range" id="music-volume" min="0" max="100" value="30" style="width:80px">
                <span id="music-volume-val">30%</span>
            </label>
            <div class="settings-item" style="font-size:0.7rem;opacity:0.6;justify-content:center;">
                &#9835; Silent Snow Lake — PROJECT SEKAI (<a href="https://www.youtube.com/watch?v=V0I4K0yJ8Hk" target="_blank" rel="noopener" style="color:inherit">source</a>)
            </div>
            <label class="settings-item">
                <span>Font</span>
                <select id="font-selector">
                    <option value="system">System Default</option>
                    <option value="noto-jp">Noto Sans JP</option>
                    <option value="inter">Inter</option>
                    <option value="poppins">Poppins</option>
                    <option value="roboto">Roboto</option>
                    <option value="opensans">Open Sans</option>
                    <option value="lato">Lato</option>
                    <option value="nunito">Nunito</option>
                    <option value="comic">Comic Neue</option>
                    <option value="dyslexic">OpenDyslexic</option>
                    <option value="mono">JetBrains Mono</option>
                </select>
            </label>
            <label class="settings-item">
                <span>Country</span>
                <select id="country-selector">
                    <option value="">Not set</option>
                    <option value="AE">&#127462;&#127466; UAE</option>
                    <option value="AR">&#127462;&#127479; Argentina</option>
                    <option value="AT">&#127462;&#127481; Austria</option>
                    <option value="AU">&#127462;&#127482; Australia</option>
                    <option value="BD">&#127463;&#127465; Bangladesh</option>
                    <option value="BE">&#127463;&#127466; Belgium</option>
                    <option value="BH">&#127463;&#127469; Bahrain</option>
                    <option value="BR">&#127463;&#127479; Brazil</option>
                    <option value="CA">&#127464;&#127462; Canada</option>
                    <option value="CH">&#127464;&#127469; Switzerland</option>
                    <option value="CL">&#127464;&#127473; Chile</option>
                    <option value="CN">&#127464;&#127475; China</option>
                    <option value="CO">&#127464;&#127476; Colombia</option>
                    <option value="CZ">&#127464;&#127487; Czechia</option>
                    <option value="DE">&#127465;&#127466; Germany</option>
                    <option value="DK">&#127465;&#127472; Denmark</option>
                    <option value="EG">&#127466;&#127468; Egypt</option>
                    <option value="ES">&#127466;&#127480; Spain</option>
                    <option value="FI">&#127467;&#127470; Finland</option>
                    <option value="FR">&#127467;&#127479; France</option>
                    <option value="GB">&#127468;&#127463; United Kingdom</option>
                    <option value="GR">&#127468;&#127479; Greece</option>
                    <option value="HK">&#127469;&#127472; Hong Kong</option>
                    <option value="HU">&#127469;&#127482; Hungary</option>
                    <option value="ID">&#127470;&#127465; Indonesia</option>
                    <option value="IE">&#127470;&#127466; Ireland</option>
                    <option value="IL">&#127470;&#127473; Israel</option>
                    <option value="IN">&#127470;&#127475; India</option>
                    <option value="IQ">&#127470;&#127478; Iraq</option>
                    <option value="IT">&#127470;&#127481; Italy</option>
                    <option value="JO">&#127471;&#127476; Jordan</option>
                    <option value="JP">&#127471;&#127477; Japan</option>
                    <option value="KE">&#127472;&#127466; Kenya</option>
                    <option value="KR">&#127472;&#127479; South Korea</option>
                    <option value="KW">&#127472;&#127484; Kuwait</option>
                    <option value="LB">&#127473;&#127463; Lebanon</option>
                    <option value="LK">&#127473;&#127472; Sri Lanka</option>
                    <option value="MX">&#127474;&#127485; Mexico</option>
                    <option value="MY">&#127474;&#127486; Malaysia</option>
                    <option value="NG">&#127475;&#127468; Nigeria</option>
                    <option value="NL">&#127475;&#127473; Netherlands</option>
                    <option value="NO">&#127475;&#127476; Norway</option>
                    <option value="NZ">&#127475;&#127487; New Zealand</option>
                    <option value="OM">&#127476;&#127474; Oman</option>
                    <option value="PH">&#127477;&#127469; Philippines</option>
                    <option value="PK">&#127477;&#127472; Pakistan</option>
                    <option value="PL">&#127477;&#127473; Poland</option>
                    <option value="PT">&#127477;&#127481; Portugal</option>
                    <option value="QA">&#127478;&#127462; Qatar</option>
                    <option value="RO">&#127479;&#127476; Romania</option>
                    <option value="RU">&#127479;&#127482; Russia</option>
                    <option value="SA">&#127480;&#127462; Saudi Arabia</option>
                    <option value="SE">&#127480;&#127466; Sweden</option>
                    <option value="SG">&#127480;&#127468; Singapore</option>
                    <option value="TH">&#127481;&#127469; Thailand</option>
                    <option value="TR">&#127481;&#127479; Turkey</option>
                    <option value="TW">&#127481;&#127484; Taiwan</option>
                    <option value="US">&#127482;&#127480; United States</option>
                    <option value="VN">&#127483;&#127475; Vietnam</option>
                    <option value="ZA">&#127487;&#127462; South Africa</option>
                </select>
            </label>
            <label class="settings-item">
                <span>School</span>
                <input type="text" id="school-input" class="settings-text-input" placeholder="e.g. Springfield Academy">
            </label>
        </div>
        <div class="daily-streak-bar">
            <div class="daily-streak-item" onclick="GEM_SHOP.open()" style="cursor:pointer" title="Open gem shop"><span class="daily-streak-val gem-val" id="gem-count">0</span><span class="daily-streak-label">gems</span></div>
            <div class="daily-streak-item"><span class="daily-streak-val" id="daily-streak">0</span><span class="daily-streak-label">day streak</span></div>
            <div class="daily-streak-item"><span class="daily-streak-val" id="daily-streak-best">0</span><span class="daily-streak-label">best</span></div>
            <div class="daily-streak-item freeze-dots" onclick="openFreezeDialog()" style="cursor:pointer" title="Manage streak freezes"><span class="freeze-dot"></span><span class="freeze-dot"></span><span class="freeze-dot"></span><span class="daily-streak-label">freezes</span></div>
        </div>
    </div>
    <!-- Streak Freeze Dialog -->
    <div id="freeze-dialog" class="freeze-dialog-overlay" onclick="if(event.target===this)closeFreezeDialog()">
        <div class="freeze-dialog">
            <button class="freeze-dialog-close" onclick="closeFreezeDialog()">&times;</button>
            <h2>Streak Freezes</h2>
            <p class="freeze-dialog-desc">A freeze automatically saves your streak if you miss a day of practice.</p>
            <div class="freeze-dialog-dots" id="freeze-dialog-dots">
                <span class="freeze-dot"></span><span class="freeze-dot"></span><span class="freeze-dot"></span>
            </div>
            <div class="freeze-dialog-count" id="freeze-dialog-count">0 / 3 freezes</div>
            <div class="freeze-dialog-balance"><span class="freeze-dialog-gem-icon">&#9830;</span> <span id="freeze-dialog-gems">0</span> gems</div>
            <button class="btn btn-primary freeze-dialog-buy" id="freeze-dialog-buy" onclick="buyStreakFreeze()">Buy Streak Freeze &#8212; 200 gems</button>
            <div class="freeze-dialog-msg" id="freeze-dialog-msg"></div>
            <div class="freeze-dialog-info">Earn gems by answering questions or completing missions. Tap your gem count to open the shop.</div>
        </div>
    </div>
    <!-- Gem Shop Dialog -->
    <div id="gem-shop" class="gem-shop-overlay" onclick="if(event.target===this)GEM_SHOP.close()">
        <div class="gem-shop">
            <button class="gem-shop-close" onclick="GEM_SHOP.close()">&times;</button>
            <h2>Gem Shop</h2>
            <div class="gem-shop-balance"><span class="gem-shop-gem-icon">&#9830;</span> <span id="gem-shop-gems">0</span> gems</div>
            <div class="gem-shop-section">
                <h3>Daily Missions</h3>
                <div id="gem-shop-daily"></div>
            </div>
            <div class="gem-shop-section">
                <h3>Milestones</h3>
                <div id="gem-shop-milestones"></div>
            </div>
            <div class="gem-shop-info">You also earn 1-5 gems per correct answer, scaled by your streak.</div>
            <img src="assets/gem-sticker.png" alt="" style="display:block;margin:12px auto 0;max-width:120px;opacity:0.9;">
        </div>
    </div>
    <!-- Hub Stats Card -->
    <div class="hub-stats" id="hub-stats"></div>
    <!-- Search Bar -->
    <div class="search-wrapper">
        <input type="text" id="search-input" class="search-input" placeholder="Search topics, activities, lessons... (Ctrl+K)" autocomplete="off">
        <div id="search-results" class="search-results"></div>
    </div>
    <div id="continue-prompt"></div>
    <div class="topic-grid">
        <div class="topic-card" data-topic="writing">
            <h2>Writing System</h2>
            <p>Learn hiragana and katakana — reading, typing, and handwriting practice.</p>
            <span class="topic-tag writing" id="writing-count"></span>
        </div>
        <div class="topic-card" data-topic="kanji-folder">
            <h2>Kanji</h2>
            <p>Study N5 kanji — meanings, readings, and stroke practice.</p>
            <span class="topic-tag kanji" id="kanji-count"></span>
        </div>
        <div class="topic-card" data-topic="grammar-folder">
            <h2>Grammar</h2>
            <p>Particles, verb conjugation, sentence structure, and adjectives.</p>
            <span class="topic-tag grammar" id="grammar-count"></span>
        </div>
        <div class="topic-card" data-topic="vocab-folder">
            <h2>Vocabulary</h2>
            <p>N5 vocabulary — flashcards, reading practice, and sentence fill.</p>
            <span class="topic-tag vocab" id="vocab-count"></span>
        </div>
        <div class="topic-card" data-topic="conv-folder">
            <h2>Conversation</h2>
            <p>Practice real-life dialogues — introductions, restaurants, directions, shopping.</p>
            <span class="topic-tag conv" id="conv-count"></span>
        </div>
        <div class="topic-card" data-topic="leaderboard">
            <h2>Leaderboard</h2>
            <p>See the top learners &mdash; compete with classmates.</p>
            <span class="topic-tag lb">Top 20</span>
        </div>
        <div class="topic-card" data-topic="study-guide">
            <h2>Study Guide</h2>
            <p>Your structured path to JLPT N5 &mdash; see what to study next.</p>
            <span class="topic-tag guide" id="sg-hub-tag">Roadmap</span>
        </div>
        <div class="topic-card" data-topic="dashboard">
            <h2>Progress Dashboard</h2>
            <p>Track your learning progress across all topics.</p>
            <span class="topic-tag dash">Overview</span>
        </div>
    </div>

    <div class="other-projects">
        <h2>Other Projects</h2>
        <div class="other-projects-grid">
            <a class="project-card" href="https://southernskiesmusic.github.io/myp-study-hub/" target="_blank" rel="noopener">
                <div class="project-icon">&#128218;</div>
                <h3>MYP Study Hub</h3>
                <p>Maths, sciences, English, humanities &amp; arts &mdash; trainers, lessons, test generators &amp; leaderboards.</p>
                <span class="topic-tag" style="background:var(--primary);color:#fff;">Live</span>
            </a>
            <a class="project-card" href="https://open.spotify.com/artist/0rGXrJXVzcYerrAVWxa1x8?si=ck_C9wWgQwisSivfBgUfEg" target="_blank" rel="noopener">
                <div class="project-icon">&#127925;</div>
                <h3>Music on Spotify</h3>
                <p>Check out my music!</p>
                <span class="topic-tag" style="background:#1db954;color:#fff;">Spotify</span>
            </a>
        </div>
    </div>
</div>

<!-- ==================== WRITING FOLDER ==================== -->
<div id="view-writing" class="view">
    <button class="back-btn" onclick="showView('hub')">Hub</button>
    <header>
        <h1>Writing System</h1>
        <p>Master hiragana and katakana</p>
    </header>
    <div class="topic-grid">
        <div class="section-label">Guided Lessons</div>
        <div class="topic-card lesson-card" data-lesson="hiragana-intro">
            <h2>Hiragana Introduction</h2>
            <p>Learn the basic Japanese syllabary — the foundation of reading.</p>
            <span class="topic-tag lesson" id="lesson-tag-hiragana-intro">Lesson</span>
        </div>
        <div class="topic-card lesson-card" data-lesson="katakana-intro">
            <h2>Katakana Introduction</h2>
            <p>Learn katakana — used for foreign words and emphasis.</p>
            <span class="topic-tag lesson" id="lesson-tag-katakana-intro">Lesson</span>
        </div>
        <div class="topic-card lesson-card" data-lesson="katakana-loanwords">
            <h2>Katakana Loan Words</h2>
            <p>Decode foreign words — learn the sound change rules and common patterns.</p>
            <span class="topic-tag lesson" id="lesson-tag-katakana-loanwords">Lesson</span>
        </div>
        <div class="section-label">Practice Activities</div>
        <div class="topic-card" data-topic="hira-activity">
            <h2>Hiragana Activity</h2>
            <p>Recognise, type, and write hiragana characters.</p>
            <span class="topic-tag writing">Activity</span>
        </div>
        <div class="topic-card" data-topic="kata-activity">
            <h2>Katakana Activity</h2>
            <p>Recognise, type, and write katakana characters.</p>
            <span class="topic-tag writing">Activity</span>
        </div>
        <div class="topic-card" data-topic="writing-canvas">
            <h2>Free Writing Pad</h2>
            <p>Open canvas for practising any character with your tablet.</p>
            <span class="topic-tag writing">Canvas</span>
        </div>
    </div>
</div>

<!-- ==================== KANJI FOLDER ==================== -->
<div id="view-kanji-folder" class="view">
    <button class="back-btn" onclick="showView('hub')">Hub</button>
    <header>
        <h1>Kanji</h1>
        <p>Study kanji meanings, readings, and writing</p>
    </header>
    <div class="topic-grid">
        <div class="section-label">Guided Lessons</div>
        <div class="topic-card lesson-card" data-lesson="kanji-basics">
            <h2>Kanji Basics</h2>
            <p>What are kanji? On'yomi vs kun'yomi, radicals, and how to study.</p>
            <span class="topic-tag lesson" id="lesson-tag-kanji-basics">Lesson</span>
        </div>
        <div class="section-label">Practice Activities</div>
        <div class="topic-card" data-topic="kanji-activity">
            <h2>Kanji Activity</h2>
            <p>Test meanings, readings, and writing for N5 kanji.</p>
            <span class="topic-tag kanji">Activity</span>
        </div>
    </div>
</div>

<!-- ==================== GRAMMAR FOLDER ==================== -->
<div id="view-grammar-folder" class="view">
    <button class="back-btn" onclick="showView('hub')">Hub</button>
    <header>
        <h1>Grammar</h1>
        <p>Japanese sentence structure and grammar patterns</p>
    </header>
    <div class="topic-grid">
        <div class="section-label">Guided Lessons</div>
        <div class="topic-card lesson-card" data-lesson="particles-intro">
            <h2>Particles Introduction</h2>
            <p>Learn は, が, を, に, で and other essential particles.</p>
            <span class="topic-tag lesson" id="lesson-tag-particles-intro">Lesson</span>
        </div>
        <div class="topic-card lesson-card" data-lesson="verb-forms">
            <h2>Verb Forms</h2>
            <p>Dictionary form, masu form, te-form, and past tense.</p>
            <span class="topic-tag lesson" id="lesson-tag-verb-forms">Lesson</span>
        </div>
        <div class="topic-card lesson-card" data-lesson="adjectives">
            <h2>Adjectives</h2>
            <p>i-adjectives and na-adjectives — conjugation and usage.</p>
            <span class="topic-tag lesson" id="lesson-tag-adjectives">Lesson</span>
        </div>
        <div class="topic-card lesson-card" data-lesson="sentence-structure">
            <h2>Sentence Structure</h2>
            <p>SOV word order, topic-comment, and building sentences.</p>
            <span class="topic-tag lesson" id="lesson-tag-sentence-structure">Lesson</span>
        </div>
        <div class="topic-card lesson-card" data-lesson="conjugation-verbs">
            <h2>Verb Conjugation</h2>
            <p>Master the essential verb forms — masu, te, nai, ta, and more.</p>
            <span class="topic-tag lesson" id="lesson-tag-conjugation-verbs">Lesson</span>
        </div>
        <div class="topic-card lesson-card" data-lesson="conjugation-adjectives">
            <h2>Adjective Conjugation</h2>
            <p>i-adjectives and na-adjectives — negative, past, and adverb forms.</p>
            <span class="topic-tag lesson" id="lesson-tag-conjugation-adjectives">Lesson</span>
        </div>
        <div class="topic-card lesson-card" data-lesson="adjectives-n5">
            <h2>N5 Adjectives</h2>
            <p>Complete vocabulary list — all essential N5 adjectives with the irregular いい.</p>
            <span class="topic-tag lesson" id="lesson-tag-adjectives-n5">Lesson</span>
        </div>
        <div class="topic-card lesson-card" data-lesson="question-words">
            <h2>Question Words</h2>
            <p>Essential interrogatives — なに, だれ, どこ, いつ, どうして, いくら, どう.</p>
            <span class="topic-tag lesson" id="lesson-tag-question-words">Lesson</span>
        </div>
        <div class="section-label">Practice Activities</div>
        <div class="topic-card" data-topic="gram-activity">
            <h2>Grammar Activity</h2>
            <p>Particles, conjugation, sentence reordering, and translation.</p>
            <span class="topic-tag grammar">Activity</span>
        </div>
        <div class="topic-card" data-topic="conj-activity">
            <h2>Conjugation Drill</h2>
            <p>Focused verb and adjective conjugation practice.</p>
            <span class="topic-tag conj">Activity</span>
        </div>
    </div>
</div>

<!-- ==================== VOCABULARY FOLDER ==================== -->
<div id="view-vocab-folder" class="view">
    <button class="back-btn" onclick="showView('hub')">Hub</button>
    <header>
        <h1>Vocabulary</h1>
        <p>Build your Japanese word bank</p>
    </header>
    <div class="topic-grid">
        <div class="section-label">Guided Lessons</div>
        <div class="topic-card lesson-card" data-lesson="counting">
            <h2>Counting &amp; Numbers</h2>
            <p>Japanese counters, number systems, and how to count things.</p>
            <span class="topic-tag lesson" id="lesson-tag-counting">Lesson</span>
        </div>
        <div class="topic-card lesson-card" data-lesson="numbers-intro">
            <h2>Japanese Numbers</h2>
            <p>Counting from 1 to 10,000 — regular and irregular readings.</p>
            <span class="topic-tag lesson" id="lesson-tag-numbers-intro">Lesson</span>
        </div>
        <div class="topic-card lesson-card" data-lesson="numbers-counters">
            <h2>Counters &amp; Time</h2>
            <p>Counter words, telling time, days of the month.</p>
            <span class="topic-tag lesson" id="lesson-tag-numbers-counters">Lesson</span>
        </div>
        <div class="topic-card lesson-card" data-lesson="family-vocab">
            <h2>Family Vocabulary</h2>
            <p>Learn humble and polite family terms — the uchi/soto distinction.</p>
            <span class="topic-tag lesson" id="lesson-tag-family-vocab">Lesson</span>
        </div>
        <div class="section-label">Practice Activities</div>
        <div class="topic-card" data-topic="vocab-activity">
            <h2>Vocabulary Activity</h2>
            <p>JP-EN flashcards, reading match, and sentence completion.</p>
            <span class="topic-tag vocab">Activity</span>
        </div>
        <div class="topic-card" data-topic="num-activity">
            <h2>Numbers Activity</h2>
            <p>Practice numbers, counters, time, dates, and money.</p>
            <span class="topic-tag num">Activity</span>
        </div>
    </div>
</div>

<!-- ==================== CONVERSATION FOLDER ==================== -->
<div id="view-conv-folder" class="view">
    <button class="back-btn" onclick="showView('hub')">Hub</button>
    <header>
        <h1>Conversation</h1>
        <p>Practice real-life Japanese dialogues</p>
    </header>
    <div class="topic-grid">
        <div class="section-label">Guided Lessons</div>
        <div class="topic-card lesson-card" data-lesson="conversations-intro">
            <h2>Everyday Conversations</h2>
            <p>Greetings, self-introductions, restaurant phrases, and asking for directions.</p>
            <span class="topic-tag lesson" id="lesson-tag-conversations-intro">Lesson</span>
        </div>
        <div class="topic-card lesson-card" data-lesson="conversations-daily">
            <h2>Shopping &amp; Services</h2>
            <p>Navigate shops, restaurants, and everyday situations with confidence.</p>
            <span class="topic-tag lesson" id="lesson-tag-conversations-daily">Lesson</span>
        </div>
        <div class="section-label">Practice Activities</div>
        <div class="topic-card" data-topic="conv-activity">
            <h2>Conversation Activity</h2>
            <p>Fill blanks, order dialogues, pick responses, and translate lines.</p>
            <span class="topic-tag conv">Activity</span>
        </div>
    </div>
</div>

<!-- ==================== CONVERSATION ACTIVITY ==================== -->
<div id="view-conv-activity" class="view">
    <button class="back-btn" onclick="showView('conv-folder')">Conversation</button>
    <header>
        <h1>Conversation Activity</h1>
        <p>Practice real-life dialogue skills</p>
    </header>
    <div class="level-select" id="conv-levels">
        <button class="level-btn active" data-level="all">All</button>
        <button class="level-btn" data-level="intro">Introductions</button>
        <button class="level-btn" data-level="restaurant">Restaurant</button>
        <button class="level-btn" data-level="directions">Directions</button>
        <button class="level-btn" data-level="shopping">Shopping</button>
    </div>
    <div class="score-bar">
        <div class="score-item"><div class="label">Score</div><div class="value primary" id="conv-score">0</div></div>
        <div class="score-item"><div class="label">Accuracy</div><div class="value success" id="conv-acc">0%</div></div>
        <div class="score-item"><div class="label">Streak</div><div class="value" id="conv-streak">0</div></div>
        <button class="timed-btn" onclick="TIMED.start('CONV', CONV)">60s Challenge</button>
    </div>
    <div class="hint-box" id="conv-hint"></div>
    <div class="question-card" id="conv-question"></div>
    <div class="feedback" id="conv-fb">
        <div class="feedback-title" id="conv-fb-title"></div>
        <div class="feedback-explanation" id="conv-fb-expl"></div>
    </div>
    <button class="btn btn-primary next-btn" id="conv-next" onclick="CONV.load()">Next</button>
    <div style="text-align:center;margin-bottom:12px;">
        <button class="btn btn-hint" id="conv-hint-btn" onclick="handleHint(CONV,'conv-hint','conv-hint-btn')">Hint</button>
    </div>
</div>

<!-- ==================== HIRAGANA ACTIVITY ==================== -->
<div id="view-hira-activity" class="view">
    <button class="back-btn" onclick="showView('writing')">Writing</button>
    <header>
        <h1>Hiragana Activity</h1>
        <p>Master all hiragana characters</p>
    </header>
    <div class="level-select" id="hira-levels">
        <button class="level-btn active" data-level="basic">Basic (46)</button>
        <button class="level-btn" data-level="dakuten">Dakuten</button>
        <button class="level-btn" data-level="combos">Combos</button>
        <button class="level-btn" data-level="all">All</button>
    </div>
    <div class="mode-toggle" id="hira-modes">
        <button class="mode-btn active" data-mode="quiz">Quiz</button>
        <button class="mode-btn" data-mode="write">Write</button>
    </div>
    <div class="score-bar">
        <div class="score-item"><div class="label">Score</div><div class="value primary" id="hira-score">0</div></div>
        <div class="score-item"><div class="label">Accuracy</div><div class="value success" id="hira-acc">0%</div></div>
        <div class="score-item"><div class="label">Streak</div><div class="value" id="hira-streak">0</div></div>
        <button class="timed-btn" onclick="TIMED.start('HIRA', HIRA)">60s Challenge</button>
    </div>
    <div class="hint-box" id="hira-hint"></div>
    <div class="question-card" id="hira-question"></div>
    <div class="feedback" id="hira-fb">
        <div class="feedback-title" id="hira-fb-title"></div>
        <div class="feedback-explanation" id="hira-fb-expl"></div>
    </div>
    <button class="btn btn-primary next-btn" id="hira-next" onclick="HIRA.load()">Next</button>
    <div style="text-align:center;margin-bottom:12px;">
        <button class="btn btn-hint" id="hira-hint-btn" onclick="handleHint(HIRA,'hira-hint','hira-hint-btn')">Hint</button>
    </div>
    <details class="rules-ref">
        <summary>Hiragana Chart</summary>
        <div class="rules-content" id="hira-ref-chart"></div>
    </details>
</div>

<!-- ==================== KATAKANA ACTIVITY ==================== -->
<div id="view-kata-activity" class="view">
    <button class="back-btn" onclick="showView('writing')">Writing</button>
    <header>
        <h1>Katakana Activity</h1>
        <p>Master all katakana characters</p>
    </header>
    <div class="level-select" id="kata-levels">
        <button class="level-btn active" data-level="basic">Basic (46)</button>
        <button class="level-btn" data-level="dakuten">Dakuten</button>
        <button class="level-btn" data-level="combos">Combos</button>
        <button class="level-btn" data-level="all">All</button>
    </div>
    <div class="mode-toggle" id="kata-modes">
        <button class="mode-btn active" data-mode="quiz">Quiz</button>
        <button class="mode-btn" data-mode="write">Write</button>
    </div>
    <div class="score-bar">
        <div class="score-item"><div class="label">Score</div><div class="value primary" id="kata-score">0</div></div>
        <div class="score-item"><div class="label">Accuracy</div><div class="value success" id="kata-acc">0%</div></div>
        <div class="score-item"><div class="label">Streak</div><div class="value" id="kata-streak">0</div></div>
        <button class="timed-btn" onclick="TIMED.start('KATA', KATA)">60s Challenge</button>
    </div>
    <div class="hint-box" id="kata-hint"></div>
    <div class="question-card" id="kata-question"></div>
    <div class="feedback" id="kata-fb">
        <div class="feedback-title" id="kata-fb-title"></div>
        <div class="feedback-explanation" id="kata-fb-expl"></div>
    </div>
    <button class="btn btn-primary next-btn" id="kata-next" onclick="KATA.load()">Next</button>
    <div style="text-align:center;margin-bottom:12px;">
        <button class="btn btn-hint" id="kata-hint-btn" onclick="handleHint(KATA,'kata-hint','kata-hint-btn')">Hint</button>
    </div>
    <details class="rules-ref">
        <summary>Katakana Chart</summary>
        <div class="rules-content" id="kata-ref-chart"></div>
    </details>
</div>

<!-- ==================== KANJI ACTIVITY ==================== -->
<div id="view-kanji-activity" class="view">
    <button class="back-btn" onclick="showView('kanji-folder')">Kanji</button>
    <header>
        <h1>Kanji Activity</h1>
        <p>Test your N5 kanji knowledge</p>
    </header>
    <div class="level-select" id="kanji-levels">
        <button class="level-btn active" data-level="n5">N5 (80)</button>
        <button class="level-btn" data-level="n4" disabled title="Coming soon">N4</button>
        <button class="level-btn" data-level="n3" disabled title="Coming soon">N3</button>
    </div>
    <div class="mode-toggle" id="kanji-modes">
        <button class="mode-btn active" data-mode="quiz">Quiz</button>
        <button class="mode-btn" data-mode="write">Write</button>
    </div>
    <div class="score-bar">
        <div class="score-item"><div class="label">Score</div><div class="value primary" id="kanji-score">0</div></div>
        <div class="score-item"><div class="label">Accuracy</div><div class="value success" id="kanji-acc">0%</div></div>
        <div class="score-item"><div class="label">Streak</div><div class="value" id="kanji-streak">0</div></div>
        <button class="timed-btn" onclick="TIMED.start('KANJI', KANJI)">60s Challenge</button>
    </div>
    <div class="hint-box" id="kanji-hint"></div>
    <div class="question-card" id="kanji-question"></div>
    <div class="feedback" id="kanji-fb">
        <div class="feedback-title" id="kanji-fb-title"></div>
        <div class="feedback-explanation" id="kanji-fb-expl"></div>
    </div>
    <button class="btn btn-primary next-btn" id="kanji-next" onclick="KANJI.load()">Next</button>
    <div style="text-align:center;margin-bottom:12px;">
        <button class="btn btn-hint" id="kanji-hint-btn" onclick="handleHint(KANJI,'kanji-hint','kanji-hint-btn')">Hint</button>
    </div>
</div>

<!-- ==================== GRAMMAR ACTIVITY ==================== -->
<div id="view-gram-activity" class="view">
    <button class="back-btn" onclick="showView('grammar-folder')">Grammar</button>
    <header>
        <h1>Grammar Activity</h1>
        <p>Practice particles, conjugation, and sentence building</p>
    </header>
    <div class="level-select" id="gram-levels">
        <button class="level-btn active" data-level="n5">N5</button>
        <button class="level-btn" data-level="n4" disabled title="Coming soon">N4</button>
        <button class="level-btn" data-level="n3" disabled title="Coming soon">N3</button>
    </div>
    <div class="score-bar">
        <div class="score-item"><div class="label">Score</div><div class="value primary" id="gram-score">0</div></div>
        <div class="score-item"><div class="label">Accuracy</div><div class="value success" id="gram-acc">0%</div></div>
        <div class="score-item"><div class="label">Streak</div><div class="value" id="gram-streak">0</div></div>
        <button class="timed-btn" onclick="TIMED.start('GRAM', GRAM)">60s Challenge</button>
    </div>
    <div class="hint-box" id="gram-hint"></div>
    <div class="question-card" id="gram-question"></div>
    <div class="feedback" id="gram-fb">
        <div class="feedback-title" id="gram-fb-title"></div>
        <div class="feedback-explanation" id="gram-fb-expl"></div>
    </div>
    <button class="btn btn-primary next-btn" id="gram-next" onclick="GRAM.load()">Next</button>
    <div style="text-align:center;margin-bottom:12px;">
        <button class="btn btn-hint" id="gram-hint-btn" onclick="handleHint(GRAM,'gram-hint','gram-hint-btn')">Hint</button>
    </div>
</div>

<!-- ==================== VOCABULARY ACTIVITY ==================== -->
<div id="view-vocab-activity" class="view">
    <button class="back-btn" onclick="showView('vocab-folder')">Vocabulary</button>
    <header>
        <h1>Vocabulary Activity</h1>
        <p>Build and test your word bank</p>
    </header>
    <div class="level-select" id="vocab-levels">
        <button class="level-btn active" data-level="n5">N5</button>
        <button class="level-btn" data-level="food">Food</button>
        <button class="level-btn" data-level="travel">Travel</button>
        <button class="level-btn" data-level="school">School</button>
        <button class="level-btn" data-level="daily">Daily</button>
        <button class="level-btn" data-level="verb">Verbs</button>
        <button class="level-btn" data-level="colour">Colours</button>
        <button class="level-btn" data-level="shopping">Shopping</button>
        <button class="level-btn" data-level="restaurant">Restaurant</button>
    </div>
    <div class="score-bar">
        <div class="score-item"><div class="label">Score</div><div class="value primary" id="vocab-score">0</div></div>
        <div class="score-item"><div class="label">Accuracy</div><div class="value success" id="vocab-acc">0%</div></div>
        <div class="score-item"><div class="label">Streak</div><div class="value" id="vocab-streak">0</div></div>
        <button class="timed-btn" onclick="TIMED.start('VOCAB', VOCAB)">60s Challenge</button>
    </div>
    <div class="hint-box" id="vocab-hint"></div>
    <div class="question-card" id="vocab-question"></div>
    <div class="feedback" id="vocab-fb">
        <div class="feedback-title" id="vocab-fb-title"></div>
        <div class="feedback-explanation" id="vocab-fb-expl"></div>
    </div>
    <button class="btn btn-primary next-btn" id="vocab-next" onclick="VOCAB.load()">Next</button>
    <div style="text-align:center;margin-bottom:12px;">
        <button class="btn btn-hint" id="vocab-hint-btn" onclick="handleHint(VOCAB,'vocab-hint','vocab-hint-btn')">Hint</button>
    </div>
</div>

<!-- ==================== CONJUGATION ACTIVITY ==================== -->
<div id="view-conj-activity" class="view">
    <button class="back-btn" onclick="showView('grammar-folder')">Grammar</button>
    <header>
        <h1>Conjugation Drill</h1>
        <p>Verb and adjective conjugation practice</p>
    </header>
    <div class="level-select" id="conj-levels">
        <button class="level-btn active" data-level="verbs">Verbs</button>
        <button class="level-btn" data-level="adjectives">Adjectives</button>
        <button class="level-btn" data-level="all">All</button>
    </div>
    <div class="score-bar">
        <div class="score-item"><div class="label">Score</div><div class="value primary" id="conj-score">0</div></div>
        <div class="score-item"><div class="label">Accuracy</div><div class="value success" id="conj-acc">0%</div></div>
        <div class="score-item"><div class="label">Streak</div><div class="value" id="conj-streak">0</div></div>
        <button class="timed-btn" onclick="TIMED.start('CONJ', CONJ)">60s Challenge</button>
    </div>
    <div class="hint-box" id="conj-hint"></div>
    <div class="question-card" id="conj-question"></div>
    <div class="feedback" id="conj-fb">
        <div class="feedback-title" id="conj-fb-title"></div>
        <div class="feedback-explanation" id="conj-fb-expl"></div>
    </div>
    <button class="btn btn-primary next-btn" id="conj-next" onclick="CONJ.load()">Next</button>
    <div style="text-align:center;margin-bottom:12px;">
        <button class="btn btn-hint" id="conj-hint-btn" onclick="handleHint(CONJ,'conj-hint','conj-hint-btn')">Hint</button>
    </div>
</div>

<!-- ==================== NUMBERS ACTIVITY ==================== -->
<div id="view-num-activity" class="view">
    <button class="back-btn" onclick="showView('vocab-folder')">Vocabulary</button>
    <header>
        <h1>Numbers Activity</h1>
        <p>Practice numbers, counters, time, and dates</p>
    </header>
    <div class="level-select" id="num-levels">
        <button class="level-btn active" data-level="basic">Numbers</button>
        <button class="level-btn" data-level="counters">Counters</button>
        <button class="level-btn" data-level="time">Time</button>
        <button class="level-btn" data-level="all">All</button>
    </div>
    <div class="score-bar">
        <div class="score-item"><div class="label">Score</div><div class="value primary" id="num-score">0</div></div>
        <div class="score-item"><div class="label">Accuracy</div><div class="value success" id="num-acc">0%</div></div>
        <div class="score-item"><div class="label">Streak</div><div class="value" id="num-streak">0</div></div>
        <button class="timed-btn" onclick="TIMED.start('NUM', NUM)">60s Challenge</button>
    </div>
    <div class="hint-box" id="num-hint"></div>
    <div class="question-card" id="num-question"></div>
    <div class="feedback" id="num-fb">
        <div class="feedback-title" id="num-fb-title"></div>
        <div class="feedback-explanation" id="num-fb-expl"></div>
    </div>
    <button class="btn btn-primary next-btn" id="num-next" onclick="NUM.load()">Next</button>
    <div style="text-align:center;margin-bottom:12px;">
        <button class="btn btn-hint" id="num-hint-btn" onclick="handleHint(NUM,'num-hint','num-hint-btn')">Hint</button>
    </div>
</div>

<!-- ==================== WRITING CANVAS (standalone) ==================== -->
<div id="view-writing-canvas" class="view">
    <button class="back-btn" onclick="showView('writing')">Writing</button>
    <header>
        <h1>Free Writing Pad</h1>
        <p>Practice writing any character</p>
    </header>
    <div class="writing-pad-container">
        <canvas id="free-canvas" class="writing-canvas has-guide" width="400" height="400"></canvas>
        <div class="writing-controls">
            <button class="btn btn-hint" onclick="WritingPad.clear('free-canvas')">Clear</button>
            <button class="btn btn-hint" onclick="WritingPad.undo('free-canvas')">Undo</button>
        </div>
    </div>
</div>

<!-- ==================== LESSON VIEW ==================== -->
<div id="view-lesson" class="view">
    <button class="back-btn" id="lesson-back-btn" onclick="LessonEngine.backToFolder()">Back</button>
    <header>
        <h1 id="lesson-title"></h1>
        <p id="lesson-subtitle"></p>
    </header>
    <div class="lesson-progress">
        <div class="lesson-progress-fill" id="lesson-progress-fill" style="width:0%"></div>
    </div>
    <div class="lesson-content" id="lesson-content"></div>
    <div class="lesson-nav" id="lesson-nav"></div>
</div>

<!-- ==================== STUDY GUIDE ==================== -->
<div id="view-study-guide" class="view">
    <button class="back-btn" onclick="showView('hub')">Hub</button>
    <header>
        <h1>JLPT N5 Study Guide</h1>
        <p>Your structured path to Japanese proficiency</p>
    </header>
    <div id="sg-overall-progress"></div>
    <div id="sg-recommended"></div>
    <div id="sg-timeline"></div>
</div>

<!-- ==================== DASHBOARD ==================== -->
<div id="view-dashboard" class="view">
    <button class="back-btn" onclick="showView('hub')">Hub</button>
    <header>
        <h1>Progress Dashboard</h1>
        <p>Your learning overview</p>
    </header>
    <div id="dashboard-content"></div>
</div>

<!-- ==================== LEADERBOARD ==================== -->
<div id="view-leaderboard" class="view">
    <button class="back-btn" onclick="showView('hub')">Hub</button>
    <header>
        <h1>Leaderboard</h1>
        <p>Top 20 students by questions answered</p>
    </header>
    <div id="leaderboard-content"><p style="color:var(--text-light);text-align:center;">Loading&hellip;</p></div>
</div>

</div><!-- end #app -->

<!-- Onboarding Modal -->
<div class="onboard-overlay" id="onboard-overlay">
    <div class="onboard-modal">
        <h2>Welcome! Tell us about yourself</h2>
        <p style="color:var(--text-light);margin-bottom:18px;">This helps us show your flag and school on the leaderboard.</p>
        <label class="onboard-field">
            <span>Country</span>
            <select id="onboard-country">
                <option value="">Select your country</option>
                <option value="AE">&#127462;&#127466; UAE</option>
                <option value="AR">&#127462;&#127479; Argentina</option>
                <option value="AT">&#127462;&#127481; Austria</option>
                <option value="AU">&#127462;&#127482; Australia</option>
                <option value="BD">&#127463;&#127465; Bangladesh</option>
                <option value="BE">&#127463;&#127466; Belgium</option>
                <option value="BH">&#127463;&#127469; Bahrain</option>
                <option value="BR">&#127463;&#127479; Brazil</option>
                <option value="CA">&#127464;&#127462; Canada</option>
                <option value="CH">&#127464;&#127469; Switzerland</option>
                <option value="CL">&#127464;&#127473; Chile</option>
                <option value="CN">&#127464;&#127475; China</option>
                <option value="CO">&#127464;&#127476; Colombia</option>
                <option value="CZ">&#127464;&#127487; Czechia</option>
                <option value="DE">&#127465;&#127466; Germany</option>
                <option value="DK">&#127465;&#127472; Denmark</option>
                <option value="EG">&#127466;&#127468; Egypt</option>
                <option value="ES">&#127466;&#127480; Spain</option>
                <option value="FI">&#127467;&#127470; Finland</option>
                <option value="FR">&#127467;&#127479; France</option>
                <option value="GB">&#127468;&#127463; United Kingdom</option>
                <option value="GR">&#127468;&#127479; Greece</option>
                <option value="HK">&#127469;&#127472; Hong Kong</option>
                <option value="HU">&#127469;&#127482; Hungary</option>
                <option value="ID">&#127470;&#127465; Indonesia</option>
                <option value="IE">&#127470;&#127466; Ireland</option>
                <option value="IL">&#127470;&#127473; Israel</option>
                <option value="IN">&#127470;&#127475; India</option>
                <option value="IQ">&#127470;&#127478; Iraq</option>
                <option value="IT">&#127470;&#127481; Italy</option>
                <option value="JO">&#127471;&#127476; Jordan</option>
                <option value="JP">&#127471;&#127477; Japan</option>
                <option value="KE">&#127472;&#127466; Kenya</option>
                <option value="KR">&#127472;&#127479; South Korea</option>
                <option value="KW">&#127472;&#127484; Kuwait</option>
                <option value="LB">&#127473;&#127463; Lebanon</option>
                <option value="LK">&#127473;&#127472; Sri Lanka</option>
                <option value="MX">&#127474;&#127485; Mexico</option>
                <option value="MY">&#127474;&#127486; Malaysia</option>
                <option value="NG">&#127475;&#127468; Nigeria</option>
                <option value="NL">&#127475;&#127473; Netherlands</option>
                <option value="NO">&#127475;&#127476; Norway</option>
                <option value="NZ">&#127475;&#127487; New Zealand</option>
                <option value="OM">&#127476;&#127474; Oman</option>
                <option value="PH">&#127477;&#127469; Philippines</option>
                <option value="PK">&#127477;&#127472; Pakistan</option>
                <option value="PL">&#127477;&#127473; Poland</option>
                <option value="PT">&#127477;&#127481; Portugal</option>
                <option value="QA">&#127478;&#127462; Qatar</option>
                <option value="RO">&#127479;&#127476; Romania</option>
                <option value="RU">&#127479;&#127482; Russia</option>
                <option value="SA">&#127480;&#127462; Saudi Arabia</option>
                <option value="SE">&#127480;&#127466; Sweden</option>
                <option value="SG">&#127480;&#127468; Singapore</option>
                <option value="TH">&#127481;&#127469; Thailand</option>
                <option value="TR">&#127481;&#127479; Turkey</option>
                <option value="TW">&#127481;&#127484; Taiwan</option>
                <option value="US">&#127482;&#127480; United States</option>
                <option value="VN">&#127483;&#127475; Vietnam</option>
                <option value="ZA">&#127487;&#127462; South Africa</option>
            </select>
        </label>
        <label class="onboard-field">
            <span>School</span>
            <input type="text" id="onboard-school" placeholder="e.g. Springfield Academy">
        </label>
        <button class="btn btn-primary" id="onboard-save" style="width:100%;margin-top:12px;">Let's go!</button>
        <button class="onboard-skip" id="onboard-skip">Skip for now</button>
    </div>
</div>

<!-- Scripts -->
<script src="js/firebase-config.js"></script>
<script src="js/utils.js"></script>
<script src="js/touch-utils.js"></script>
<script src="js/data/hiragana.js"></script>
<script src="js/data/katakana.js"></script>
<script src="js/data/kanji-n5.js"></script>
<script src="js/data/grammar-n5.js"></script>
<script src="js/data/vocab-n5.js"></script>
<script src="js/data/particles.js"></script>
<script src="js/data/conversations.js"></script>
<script src="js/data/conjugations.js"></script>
<script src="js/data/numbers.js"></script>
<script src="js/writing-pad.js"></script>
<script src="js/activities/hira.js"></script>
<script src="js/activities/kata.js"></script>
<script src="js/activities/kanji.js"></script>
<script src="js/activities/gram.js"></script>
<script src="js/activities/vocab.js"></script>
<script src="js/activities/conv.js"></script>
<script src="js/activities/conj.js"></script>
<script src="js/activities/num.js"></script>
<script src="js/auth.js"></script>
<script src="js/lessons/lesson-engine.js"></script>
<script src="js/lessons/hiragana-intro.js"></script>
<script src="js/lessons/katakana-intro.js"></script>
<script src="js/lessons/kanji-basics.js"></script>
<script src="js/lessons/particles-intro.js"></script>
<script src="js/lessons/verb-forms.js"></script>
<script src="js/lessons/adjectives.js"></script>
<script src="js/lessons/sentence-structure.js"></script>
<script src="js/lessons/counting.js"></script>
<script src="js/lessons/conversations-intro.js"></script>
<script src="js/lessons/conversations-daily.js"></script>
<script src="js/lessons/conjugation-verbs.js"></script>
<script src="js/lessons/conjugation-adjectives.js"></script>
<script src="js/lessons/numbers-intro.js"></script>
<script src="js/lessons/numbers-counters.js"></script>
<script src="js/lessons/katakana-loanwords.js"></script>
<script src="js/lessons/family-vocab.js"></script>
<script src="js/lessons/question-words.js"></script>
<script src="js/lessons/adjectives-n5.js"></script>
<script src="js/dashboard.js"></script>
<script src="js/study-guide.js"></script>
<script src="js/init.js"></script>
</body>
</html>
